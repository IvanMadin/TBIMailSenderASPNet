@model EmailViewModel

@{
    ViewData["Title"] = "Email Preview";
}

<link rel="stylesheet" href="~/css/application.css">

<div class="container" style="margin-left:3%">
    <h2>
        "@Model.Subject" <br />
        By @Model.Sender

    </h2>
    <h6>
        @if (User.IsInRole("Operator"))
        {
            <partial name="_ApplicationOperatorButtons" model="@Model" />
        }
        @if (User.IsInRole("Manager"))
        {
            <partial name="_ApplicationManagerButtons" model="@Model" />
        }
    </h6>
    <br />
    <div>
        <dl class="row">
            <dt class="col-sm-2">
                Data Received:
            </dt>
            <dd class="col-sm-10">
                @Model.DateReceived
            </dd>
            <dt class="col-sm-2">
                Status:
            </dt>
            <dd class="col-sm-10">
                @Model.EmailStatusName
            </dd>
            <partial name="_EmailPreviewAttachmentsPrint" model="@Model" />
            <dt class="col-sm-2">
                Body:
            </dt>
            <dd class="col-sm-4" style="overflow-wrap: break-word;">
                @Html.Raw(Model.Body)
            </dd>
        </dl>
    </div>
</div>
<div id="testvamsi" data-value="@Model.Id">

</div>
<div class="col-4" id="application-form-div">
    <partial name="_AppFormPartial" model="new LoanApplicationViewModel { EmailId = Model.Id }" />
</div>

@section Scripts{
    <script type="text/javascript" src="~/js/application-form.js"></script>

    <script>

        let currid;
        window.addEventListener('load', function (event) {

            let id = document.getElementById("testvamsi").getAttribute("data-value");
            currid = id;

            $.ajax({
                type: 'Post',
                url: '/Email/Test',
                data: {
                    'emailId': id,
                    'status': true
                }
            });
        });

        window.addEventListener('unload', function () {
            test2();
        });


        function test2() {
            console.log(currid);
            $.ajax({
                type: 'Post',
                async : false,
                url: '/Email/Test',
                data: {
                    'emailId': currid,
                    'status': false
                }
            });
        }
    </script>
}





